todo

Roteiro Projeto Demonstrativo 2 - Calibração de Câmeras

Objetivo
Esta atividade tem como objetivo principal avaliar os aspectos da calibração de câmeras, realizando o desenvolvimento de uma "régua visual".

Procedimentos
Requisito 1: medição de um segmento de reta
Desenvolva uma aplicação em OpenCV que a partir da utilização de uma entrada (clique de mouse), seja capaz de capturar a posição inicial - xi,yi (primeiro clique de mouse) e a posição final xf,yf (segundo clique do mouse) e permita desenhar uma linha na tela. 

Utilize uma função de chamada ao sistema pelo mouse, por exemplo: http://opencvexamples.blogspot.com/2014/01/detect-mouse-clicks-and-moves-on-image.html

Calcule o comprimento desta linha em pixels e imprima-o no console. O comprimento deverá ser dado pela distância Euclidiana bidimensional.

Requisito 2: calibração de intrínsecos
Realize a calibração de uma câmera digital, gerando os arquivos "XML" com os parâmetros intrínsecos e distorções provenientes do processo de calibração. Utilize para o desenvolvimento da aplicação de forma mais simples, o programa de calibração disponibilizado no tópico da atividade, incluindo o padrão de calibração.  A partir da saída do vídeo na janela "raw" e "undistorted" desta aplicação, acople-a ao código da aplicação desenvolvida no Requisito 1 de forma que seja possível medir distâncias em pixels nessas duas janelas.

Observações
Para a calibração, capture pelo menos 10 imagens (spanspots), apresentando o template de tabuleiro de xadrez (lembrando que se for usar o template, o tamanho do quadrado é definido de acordo com a precisão impressora utilizada. Utilize uma régua de qualidade para medir o tamanho do quadrado impresso do padrão de referência) passando por todas as áreas visíveis da imagem (explorando as áreas de formas proporcionais). Isto é de fundamental importância para que os parâmetros de distorção da câmera sejam estimados mais precisamente. Repita este procedimento pelo menos 5 (cinco) vezes, armazenando cada arquivo XML gerado em separado, e para todos os parâmetros obtidos, tire a média e o desvio padrão para cada parâmetro da calibração obtido.

Atenção: para os próximos passos, utilize a média destes parâmetros obtidos em um novo arquivo XML tanto para a distorção (distortion.xml), quanto para os parâmetros intrínsecos (intrisics.xml).

Dica importante: realize o processo de calibração em um ambiente com boa iluminação.

Requisito 3: calibração de extrínsecos
Meça, com uma boa régua, os retângulos do padrão de calibração impresso e use esse padrão para determinar o sistema de coordenadas do mundo (world coordinate frame).

Armazene as coordenadas reais dos 48 pontos do padrão. Assuma que o sistema de coordenadas do mundo tenha a origem (0,0,0)T no primeiro ponto da página (i.e., primeira interseção entre quatro retângulos) e que o papel esteja alinhado com as coordenadas X e Y (ou seja, Z=0 para todos os pontos do padrão de calibração).

Implemente um programa que use as medidas acima, bem como os dados de calibração obtidos para o requisito 2, para calcular os parâmetros extrínsecos da câmera.

Repita esse processo de calibração de extrínsecos com o padrão de calibração situado a pelo menos 3 distâncias diferentes do centro da camera:

dmin: o mais próximo possível, desde que todos os 48 pontos sejam visíveis,
dmax: o mais distante possível, desde que esses pontos possam ser capturados pelo algoritmo,
dmed: e numa distância intermediária.
Ao realizar tais calibrações, meça com uma trena a distância entre o centro da câmera e a origem do padrão de calibração e use isso para avaliar os resultados de calibração obtidos, ou seja, verifique o quão similar é essa distância e a norma do vetor de translação do mundo para a câmera |t|. Anote seus resultados e discuta o efeito da distância no calculo dos parâmetros de translação. Para cada posição acima (dmin, dmed e dmax), repita o processo pelo menos 3 vezes para poder calgular a média e o desvio padrão da distância entre a coordenada do mundo e a da câmera. Esse desvio padrão informa quão confiáveis são as estimativas.

Requisito 4: régua visual
Terminado o processo de calibração acima e utilizando a imagem de vídeo das saídas "raw" e "undistorted" definidas pela aplicação e algum objeto com dimensão (altura ou largura) conhecida faça, para cada posição (dmin, dmed e dmax) as seguintes operações:

Meça o objeto conhecido usando o procedimento do requisito 1 em ambas imagens (raw e undistorted).
Com cliques de mouse, você obterá medidas em pixels em ambas imagens. Usando os parâmetros de calibração obtidos, mapeie essas medidas para metros.
Anote os resutados obtidos (metidas, em metro) do objeto para cada distância (dmin, dmed e dmax), e também usando medidas feitas nas imagens raw e undistorted. Anote também o valor real do tamanho do objeto (conforme medido, por exemplo, com uma régua).
Repita o processo acima várias vezes para cada distância da câmera, adquirindo medições do objeto situado próximo ao centro da imagem e também próximo a uma das bordas da imagem.
Faça tabelas consolidadas (já utilizando os valores médios e desvio padrão) com estes resultados, como indicado abaixo.

Posição do padrão de calibração	dmin	dmed	dmax
|t|, medida pela trena	 	 	 
|t|, calculada pela calibração extrínseca	 	 	 
lraw,centre	 	 	 
lraw,perifery	 	 	 
lundistorted,centre	 	 	 
lundistorted,perifery	 	 	 
onde

t é o vetor de translação entre o centro da câmera e a origem do objeto de calibração e |t| é sua norma, ou seja, a distância entre a câmera e o objeto de calibração.
lraw,centre é o comprimento do objeto conhecido (que foi previamente medido com uma régua), em milímetros, conforme calculado a partir de cliques do mouse na imagem raw, para o objeto localizado próximo ao centro da imagem.
lraw,perifery é o comprimento (mm) do objeto, conforme calculado a partir de cliques do mouse na imagem raw, para o objeto localizado próximo à periferia (uma das bordas) da imagem.
lundistorted,centre é o comprimento (mm) do objeto, conforme calculado a partir da imagem undistorted, para o objeto localizado próximo ao centro da imagem.
lundistorted,perifery é o comprimento (mm) do objeto, conforme calculado a partir da imagem undistorted, para o objeto localizado próximo à periferia imagem.
Requisito 5: análise
Discuta os principais elementos causadores das variações das medições obtidas com a esperada (medida real do objeto avaliado). Avalie a característica do hardware da câmera e quais fatores podem ser os causadores destas possíveis diferenças. Proponha/discuta quais fatores podem ser melhorados/aprimorados para que esta medição seja feita com a maior precisão possível.